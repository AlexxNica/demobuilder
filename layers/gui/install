#!/bin/bash -x

. vm-functions

register_channels rhel-x86_64-server-6
yum_update
install_packages evince firefox gdm gnome-panel gnome-session gnome-terminal man nautilus tigervnc-server urw-fonts xorg-x11-xinit

useradd demo
echo redhat | passwd --stdin demo
echo 'demo ALL=(ALL) NOPASSWD: ALL' >>/etc/sudoers
passwd -l root

su demo -c 'gconftool-2 --type int --set /apps/metacity/general/num_workspaces 1'

sed -i -e 's/id:3:initdefault:/id:5:initdefault:/' /etc/inittab

sed -i -e '/^\[greeter\]/a \
IncludeAll=false \
Include=demo' /etc/gdm/custom.conf

# su demo -c 'mkdir ~/.vnc; echo redhat | vncpasswd -f >~/.vnc/passwd; chmod 0600 ~/.vnc/passwd'
# echo "su demo -c 'vncserver :0'" >>/etc/rc.local
# lokkit -p 5900:tcp
